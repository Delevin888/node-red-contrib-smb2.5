<!--
Copyright 2018 Smart-Tech Controle e Automação
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<script type="text/x-red" data-template-name="SMB">

    <div class="form-row">
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            <span data-i18n="smb.label.name"></span>
        </label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]smb.label.name">
    </div>

    <div class="form-row">
        <label for="node-input-config">
            <i class="fa fa-cog"></i>
            <span data-i18n="smb.label.config"></span>
        </label>
        <input type="text" id="node-input-config" data-i18n="[placeholder]smb.label.config">
    </div>

    <div class="form-row">
        <label for="node-input-operation">
            <i class="fa fa-bars"></i>
            <span data-i18n="smb.label.operation"></span>
        </label>
        <select type="text" id="node-input-operation">
            <option value="read-dir" data-i18n="smb.operation.read-dir"> </option>
            <option value="read-file" data-i18n="smb.operation.read-file"> </option>
            <option value="unlink" data-i18n="smb.operation.unlink"> </option>
            <option value="rename" data-i18n="smb.operation.rename"> </option>
            <option value="create" data-i18n="smb.operation.create"> </option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-path">
            <i class="fa fa-folder-open"></i>
            <span data-i18n="smb.label.path"></span>
        </label>
        <input type="text" id="node-input-path" data-i18n="[placeholder]smb.label.path">
    </div>

    <div class="form-row" id="new-path">
        <label for="node-input-path_new">
            <i class="fa fa-folder-open"></i>
            <span data-i18n="smb.label.path-new"></span>
        </label>
        <input type="text" id="node-input-path_new" data-i18n="[placeholder]smb.label.path-new">
    </div>

</script>

<script type="text/x-red" data-help-name="SMB">
    <p>
        <b>Node SMB Protocol</b>
    </p>
    
    <h3>Input</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">string | object</span>
        </dt>
        <dd>triggers the action defined in the operation.</dd>
    </dl>


    <h3>Details</h3>
    <dl class="message-properties">
        <dt>config
            <span class="property-type">SMB Config</span>
        </dt>
        <dd>the path to operate on.</dd>
    </dl>


    <h3>Operations</h3>

    <dl class="message-properties">

        <dt>Read directory</dt>
        <dd>this operation return an array of file object.
            If not set <code>Path</code> in node properties then <code>INPUT: msg.payload</code> is used as Path.
        </dd>

        <dt>Read file</dt>
        <dd>
            this operation return a string with content of file.
            If not set <code>Path</code> in node properties, then <code>INPUT: msg.payload</code> is used as Path.
        </dd>

        <dt>Remove file</dt>
        <dd>
            this operation remove file.
            If not set <code>Path</code> in node properties then <code>INPUT: msg.payload</code> is used as Path.
        </dd>

        <dt>Rename/Move file</dt>
        <dd>
            this operation move or rename file.
            If not set <code>Path</code> and <code>New path</code> in node properties, then <code>INPUT: msg.payload.currently</code> is used as Path and <code>INPUT: msg.payload.new</code> is used as New Path.
        </dd>

        <dt>Create file</dt>
        <dd>
            this operation create new file.
            If not set <code>Path</code> in node properties, then <code>INPUT: msg.payload.fileName</code> is used as Path and <code>INPUT: msg.payload.data</code> is content of file.
        </dd>

    </dl>

</script>

<script type="text/javascript">
    RED.nodes.registerType('SMB', {
        category: 'storage',
        color: '#DEB887',
        defaults: {
            name: {
                value: ""
            },
            config: {
                value: "",
                type: "smb config"
            },
            operation: {
                value: "read-dir"
            },
            path: {
                value: ""
            },
            path_new: {
                value: ""
            }

        },
        inputs: 1,
        outputs: 1,
        icon: "file.png",
        paletteLabel: "smb",
        label: function () {
            
            if (this.name) {
                return this.name;
            }

            var selectConfig = RED.nodes.node(this.config);
            
            if (selectConfig) {

                let operation = "";

                switch(this.operation){
                    case "read-dir":
                        operation = "Read dir";
                        break;

                    case "read-file":
                        operation = "Read file";
                        break;

                    case "rename": 
                        operation = "Rename/Move";
                        break;

                    case "unlink": 
                        operation = "Remove";
                        break;

                    case "create": 
                        operation = "Create";
                        break;
                }

                return selectConfig.label() + " : " + operation;
            }

        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function(){
            
            let new_path = $("#new-path");
            let operation_select = $("#node-input-operation");
            
            new_path.hide();

            if(operation_select.val() == "rename"){
                new_path.show();
            }else{
                new_path.hide();
            }

            operation_select.change(function(){
              
                new_path.hide();
                
                if(operation_select.val() == "rename"){
                    new_path.show();
                }
            });

        }
    });
</script>



<!-- CONFIG -->

<script type="text/x-red" data-template-name="smb config">

    <div class="form-row">
        <label for="node-config-input-name">
            <i class="fa fa-tag"></i>
            <span data-i18n="smb.label.name"></span>
        </label>
        <input type="text" id="node-config-input-name" data-i18n="[placeholder]smb.label.name">
    </div>

    <div class="form-row">
        <label for="node-config-input-share">
            <i class="fa fa-sitemap"></i>
            <span data-i18n="smb.label.share"></span>
        </label>
        <input type="text" id="node-config-input-share" data-i18n="[placeholder]smb.label.share">
    </div>

    <div class="form-row">
        <label for="node-config-input-domain">
            <i class="fa fa-globe"></i>
            <span data-i18n="smb.label.domain"></span>
        </label>
        <input type="text" id="node-config-input-domain" data-i18n="[placeholder]smb.label.domain">
    </div>

    <div class="form-row">
        <label for="node-config-input-username">
            <i class="fa fa-user"></i>
            <span data-i18n="smb.label.username"></span>
        </label>
        <input type="text" id="node-config-input-username" data-i18n="[placeholder]smb.label.username">
    </div>

    <div class="form-row">
        <label for="node-config-input-password">
            <i class="fa fa-key"></i>
            <span data-i18n="smb.label.password"></span>
        </label>
        <input type="password" id="node-config-input-password" data-i18n="[placeholder]smb.label.password">
    </div>


</script>

<script type="text/x-red" data-help-name="smb config">
    <p>
        <b>Node SMB Protocol</b>
    </p>

    <h3>Details</h3>

    <dl class="message-properties">
        <dt>Share
            <span class="property-type">string</span>
        </dt>
        <dd>define the path sharing.</dd>
    </dl>

    <dl class="message-properties">
        <dt>Domain
            <span class="property-type">string</span>
        </dt>
        <dd>define the domain for authentication.</dd>
    </dl>

    <dl class="message-properties">
        <dt>Username
            <span class="property-type">string</span>
        </dt>
        <dd>define the username for authentication.</dd>
    </dl>

    <dl class="message-properties">
        <dt>Password
            <span class="property-type">string</span>
        </dt>
        <dd>define the password for authentication.</dd>
    </dl>
</script>

<script type="text/javascript">
    RED.nodes.registerType("smb config", {
        category: 'config',
        color: '#FFAAAA',
        defaults: {
            name: {
                value: ""
            },
            share: {
                value: ""
            },
            domain: {
                value: ""
            }
        },
        credentials: {
            username: {
                type: "text"
            },
            password: {
                type: "password"
            }
        },
        label: function () {
            return this.name || this.share;
        }
    });
</script>

